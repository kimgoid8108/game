document.addEventListener("DOMContentLoaded",()=>{const owner=document.querySelector("#owner"),shopinven=document.querySelector("#shopinven"),close=document.querySelector("#close");if(owner&&shopinven)owner.addEventListener("click",()=>{shopinven.style.display="block"});if(close&&shopinven)close.addEventListener("click",()=>{shopinven.style.display="none"})});const items=[{id:"potion",info:"potioninfo",yes:"potionYes",no:"potionNo",price:10,name:"ìž‘ì€ í¬ì…˜ðŸ§ª"},{id:"bigPotion",info:"bigPotioninfo",yes:"bigPotionYes",no:"bigPotionNo",price:25,name:"í° í¬ì…˜ðŸ§ª"},{id:"attackPotion",info:"attackPotioninfo",yes:"attackPotionYes",no:"attackPotionNo",price:30,name:"ê³µê²©ë ¥ í¬ì…˜âš”ï¸"},{id:"defensePotion",info:"defensePotioninfo",yes:"defensePotionYes",no:"defensePotionNo",price:30,name:"ë°©ì–´ë ¥ í¬ì…˜ðŸ›¡ï¸"},{id:"expPotion",info:"expPotioninfo",yes:"expPotionYes",no:"expPotionNo",price:40,name:"ê²½í—˜ì¹˜ í¬ì…˜â­"},{id:"goldPotion",info:"goldPotioninfo",yes:"goldPotionYes",no:"goldPotionNo",price:40,name:"ê³¨ë“œ í¬ì…˜ðŸ’°"}];items.forEach(item=>{const el=document.querySelector(`#${item.id}`),info=document.querySelector(`#${item.info}`),yes=document.querySelector(`#${item.yes}`),no=document.querySelector(`#${item.no}`);if(el&&info)el.addEventListener("click",()=>{info.style.display="flex"});if(yes&&no){yes.addEventListener("click",()=>{let gold=parseInt(localStorage.getItem("playerGold"))||0;if(gold>=item.price){gold-=item.price;localStorage.setItem("playerGold",gold);addToInventory(item.name);if(info)info.style.display="none";showItemNotification("êµ¬ë§¤ì™„ë£Œ",`${item.name}ì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`)}else{showItemNotification("ì•Œë¦¼","ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");if(info)info.style.display="none"}});no.addEventListener("click",()=>{if(info)info.style.display="none"})}});function showItemNotification(title,message){const n=document.createElement("div");n.className="reward-notification item-notification";n.innerHTML=`<div class="reward-content"><h3>${title}</h3><p>${message}</p></div>`;document.body.appendChild(n);setTimeout(()=>n.classList.add("show"),10);setTimeout(()=>{n.classList.remove("show");setTimeout(()=>n.remove(),300)},2000)}function addToInventory(itemName){let inv=JSON.parse(localStorage.getItem("inventory"))||{};inv[itemName]=(inv[itemName]||0)+1;localStorage.setItem("inventory",JSON.stringify(inv));updateInventoryUI();if(typeof window.updateQuickSlots==="function")window.updateQuickSlots()}function updateInventoryUI(){const list=document.getElementById("inventory-items");if(!list)return;list.innerHTML="";const inv=JSON.parse(localStorage.getItem("inventory"))||{};for(const[item,count]of Object.entries(inv)){const li=document.createElement("li");li.textContent=count>1?`${item} x${count}`:item;li.style.cssText="cursor:grab;padding:5px;border-radius:5px;transition:background .2s;user-select:none";li.setAttribute("draggable","true");li.setAttribute("data-item",item);li.addEventListener("mouseenter",()=>li.style.background="rgba(255,255,255,.1)");li.addEventListener("mouseleave",()=>li.style.background="transparent");li.addEventListener("click",()=>useItem(item));li.addEventListener("dragstart",(e)=>{e.dataTransfer.setData("text/plain",item);e.dataTransfer.effectAllowed="move";li.classList.add("dragging")});li.addEventListener("dragend",()=>{li.classList.remove("dragging")});list.appendChild(li)}}function useItem(itemName){const inv=JSON.parse(localStorage.getItem("inventory"))||{};if(!inv[itemName]||inv[itemName]<=0){showItemNotification("ì•Œë¦¼","ì‚¬ìš©í•  ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤!");return}const hpEl=document.getElementById("HP");if((itemName==="ìž‘ì€ í¬ì…˜ðŸ§ª"||itemName.includes("ìž‘ì€ í¬ì…˜"))&&hpEl){const hpParent=hpEl.parentElement,hpText=hpParent.textContent,hpMatch=hpText.match(/(\d+)\/(\d+)/);let currentHP,maxHP=100;if(hpMatch){currentHP=parseInt(hpMatch[1]);maxHP=parseInt(hpMatch[2])}else currentHP=parseInt(hpEl.textContent)||0;currentHP=Math.min(currentHP+50,maxHP);hpEl.textContent=currentHP;showItemNotification("ì²´ë ¥ íšŒë³µ",`ì²´ë ¥ì„ 50 íšŒë³µí–ˆìŠµë‹ˆë‹¤! (${currentHP}/${maxHP})`);inv[itemName]--;if(inv[itemName]<=0)delete inv[itemName];localStorage.setItem("inventory",JSON.stringify(inv));updateInventoryUI();if(typeof window.updateBottomUI==="function")window.updateBottomUI()}else if(itemName==="í° í¬ì…˜ðŸ§ª"&&hpEl){const hpParent=hpEl.parentElement,hpText=hpParent.textContent,hpMatch=hpText.match(/(\d+)\/(\d+)/);if(hpMatch){let currentHP=parseInt(hpMatch[1]),maxHP=parseInt(hpMatch[2]);currentHP=Math.min(currentHP+100,maxHP);hpEl.textContent=currentHP;showItemNotification("ì²´ë ¥ íšŒë³µ",`ì²´ë ¥ì„ 100 íšŒë³µí–ˆìŠµë‹ˆë‹¤! (${currentHP}/${maxHP})`);inv[itemName]--;if(inv[itemName]<=0)delete inv[itemName];localStorage.setItem("inventory",JSON.stringify(inv));updateInventoryUI();if(typeof window.updateBottomUI==="function")window.updateBottomUI()}}else if(itemName==="ì² ê²€ðŸ—¡ï¸"){showItemNotification("ë¬´ê¸° ìž¥ì°©","ì² ê²€ì„ ìž¥ì°©í–ˆìŠµë‹ˆë‹¤!");const heroEl=document.getElementById("Hero"),heroPhoto=document.querySelector("#Heroinfo .photo");if(heroEl)heroEl.style.backgroundImage="url('image/Swordhero.png')";if(heroPhoto)heroPhoto.src="image/Swordhero.png";localStorage.setItem("equippedWeapon","ì² ê²€ðŸ—¡ï¸");if(typeof window.updateWeaponSlots==="function")window.updateWeaponSlots();const gunInv=JSON.parse(localStorage.getItem("inventory"))||{};if(!gunInv["ì´ðŸ”«"]){gunInv["ì´ðŸ”«"]=1;localStorage.setItem("inventory",JSON.stringify(gunInv));updateInventoryUI()}}else if(itemName==="ì´ðŸ”«"){showItemNotification("ë¬´ê¸° ìž¥ì°©","ì´ì„ ìž¥ì°©í–ˆìŠµë‹ˆë‹¤!");const heroEl=document.getElementById("Hero"),heroPhoto=document.querySelector("#Heroinfo .photo");if(heroEl)heroEl.style.backgroundImage="url('image/hero.png')";if(heroPhoto)heroPhoto.src="image/hero.png";localStorage.setItem("equippedWeapon","ì´ðŸ”«");if(typeof window.updateWeaponSlots==="function")window.updateWeaponSlots()}else if(itemName.includes("í¬ì…˜")){const buffs=JSON.parse(localStorage.getItem("buffs"))||{};let msg="";if(itemName==="ê³µê²©ë ¥ í¬ì…˜âš”ï¸"){buffs.attack=Date.now()+3e5;msg="ê³µê²©ë ¥ì´ 5ë¶„ê°„ ì¦ê°€í–ˆìŠµë‹ˆë‹¤!"}else if(itemName==="ë°©ì–´ë ¥ í¬ì…˜ðŸ›¡ï¸"){buffs.defense=Date.now()+3e5;msg="ë°©ì–´ë ¥ì´ 5ë¶„ê°„ ì¦ê°€í–ˆìŠµë‹ˆë‹¤!"}else if(itemName==="ê²½í—˜ì¹˜ í¬ì…˜â­"){buffs.exp=Date.now()+3e5;msg="ê²½í—˜ì¹˜ 2ë°° íšë“ ë²„í”„ê°€ 5ë¶„ê°„ ì§€ì†ë©ë‹ˆë‹¤!"}else if(itemName==="ê³¨ë“œ í¬ì…˜ðŸ’°"){buffs.gold=Date.now()+3e5;msg="ê³¨ë“œ 2ë°° íšë“ ë²„í”„ê°€ 5ë¶„ê°„ ì§€ì†ë©ë‹ˆë‹¤!"}showItemNotification("ë²„í”„ íšë“",msg);localStorage.setItem("buffs",JSON.stringify(buffs));inv[itemName]--;if(inv[itemName]<=0)delete inv[itemName];localStorage.setItem("inventory",JSON.stringify(inv));updateInventoryUI()}else{showItemNotification("ì•„ì´í…œ ì‚¬ìš©",`${itemName}ì„(ë¥¼) ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤!`);inv[itemName]--;if(inv[itemName]<=0)delete inv[itemName];localStorage.setItem("inventory",JSON.stringify(inv));updateInventoryUI()}}document.addEventListener("DOMContentLoaded",()=>{updateInventoryUI()});
